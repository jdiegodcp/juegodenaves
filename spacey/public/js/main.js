var nave,phpadd="<?php\tinclude 'config.php';?>";$("#formLogin").on("submit",function(e){e.preventDefault();var o=$("#nickname").val(),a=$("#dni").val(),n=urlBase+"api/guardar-usuario",e={nombre:o,dni:a};localStorage.getItem("dni")||localStorage.setItem("dni",a),$.ajax({url:n,type:"POST",data:e,dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){console.log("enviado")},complete:function(){console.log("completo")},success:function(e){localStorage.setItem("jugador",o),window.open("JuegoSpaceY","_top")},error:function(e,o,a){console.log("hay un error")}})});var teclado=new Teclado;function init(){for(var e,c=[],o=(document.getElementById("app"),$("#app")),a=0;a<20;a++)e=new Meteoro,o.append(e),c.push(e);nave=new Jugador,o.append(nave);var n=0,t=0,r=0,i=0;setInterval(function(){i++},1);var l=$(window).width(),s=!1;function u(e){e=e.css("left").split("px");return Number(e[0])}function d(e){e=e.css("top").split("px");return Number(e[0])}$("*").click(function(e){s=e}).mouseup(function(){s=!1}),setInterval(function(){nave.arrayBalas;teclado.izquierda()&&teclado.derecha()||(teclado.izquierda()||s?nave.moverIzquierda():teclado.derecha()&&nave.moverDerecha());0!=s&&(1==function(e){return e.pageX>l/2?1:0}(s)?nave.moverDerechaInmediato(s.pageX):nave.moverIzquierdaInmediato(s.pageX));(function(){var e,o,a,n,t,r,i=nave.arrayBalas;$(nave).css("left").split("px")[0];for(e=0;e<i.length&&0!=i[e].length;e++)for(a=u(i[e]),n=d(i[e]),cont=0,o=0;o<c.length&&0!=c[o].length;o++)if(t=u(c[o]),r=d(c[o]),(t<=a&&a<=t+30||t<=a+14&&a+14<=t+30)&&r<=n&&n<=r+30){cont+=1,i[e].addClass("desvanece"),c[o].addClass("meteoroout"),c[o].remove(),c.splice(o,1),i[e].remove(),i.splice(e,1),o--,e--;break}})(),40*++n%100==0&&(r++,0==c.length&&0==t&&(t++,function(){var e=localStorage.getItem("jugador"),o=Math.round(1e3*Math.random()),a=function(e){var o=parseInt(e/3600),a=parseInt(e%3600/60),e=parseInt(e%3600%60)+"s";0<a&&(e=a+"min "+e,0<o&&(e=o+"h "+e));return e}(i/10);torden=r;e={jugador:e,tiempo:o=a,torden:torden},a=localStorage.getItem("arrayRecords");null==a?a=[e]:(a=JSON.parse(a)).push(e);localStorage.setItem("tiempo",o),localStorage.setItem("tiempos",i),function(){var e=localStorage.getItem("jugador"),o=localStorage.getItem("tiempos"),a=urlBase+"api/guardar-juego",o={idUsuario:e,score:o};$.ajax({url:a,type:"POST",data:o,dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){console.log("enviado")},complete:function(){console.log("completo")},success:function(e){window.open("puntaje","_top")},error:function(e,o,a){console.log("hay un error")}})}()}()))},25)}function Bala(e,o){var a=$("<img class='balitas'>");return a.attr({src:"img/bala2.png"}),a.css({left:e,top:o}),a.mover=function(){setTimeout(function(){a.addClass("final")},20)},a}function Jugador(){var a=$("#app"),n=$("<img>");n.arrayBalas=[];function o(){var e,o=new Bala(t()-10,(e=n.css("top").split("px"),Number(e[0]))-10);a.append(o),n.arrayBalas.push(o),o.mover(),setTimeout(function(){o.remove(),n.eliminarBala(o),o=null},3e3)}function t(){var e=n.css("left").split("px");return Number(e[0])}return n.attr({id:"naven"}),n.attr({src:"img/nave2.png"}),n.eliminarBala=function(e){for(var o=0;o<n.arrayBalas.length;o++)n.arrayBalas[o]==e&&n.arrayBalas.splice(o,1)},n.moverDerecha=function(){var e=t();n.css({left:e+60}),o()},n.moverDerechaInmediato=function(e){t();n.css({left:e}),o()},n.moverIzquierda=function(){var e=t();n.css({left:e-60}),o()},n.moverIzquierdaInmediato=function(e){t();n.css({left:e}),o()},n}function MovimientoJugador(e){var o=document.getElementById("naven");style=window.getComputedStyle(o),left=style.getPropertyValue("left");o=left.length;left.substring(0,o-2)}init();var mouseStillDown=!1,presionado=!1;function Meteoro(){var e,o,a,n=$("<img>");return e="img/"+(e=Math.round(1+2*Math.random()))+".png",o=$(window).width(),a=$(window).height(),o=Math.random()*(o-100),a=Math.random()*(a-200),n.attr({src:e}),n.css({width:"30px"}),n.css({height:"30px"}),n.css({position:"absolute",top:a+"px",left:o+"px"}),n}$("*").click(function(e){presionado=e}).mouseup(function(){presionado=!1});var urlBase="<?php echo HOST_API; ?>",url=urlBase+"api/cargar-puntajes";function mostrartabla(e){for(var o,a,n,t,r=$("#cuerpoRanking"),i=0;i<e.length;i++)e[i],t=e[i].score,n=e[i].nombre,o=$("<tr>"),(a=$("<td>")).html(i+1),o.append(a),(a=$("<td>")).html(n),o.append(a),(a=$("<td>")).html(getTime(t/10)),o.append(a),r.append(o)}function getTime(e){var o=parseInt(e/3600),a=parseInt(e%3600/60),e=parseInt(e%3600%60)+" s";return 0<a&&(e=a+" min "+e,0<o&&(e=o+" h "+e)),e}function Teclado(){var n=$("body"),t=[{codigo:37,nombre:"izquierda",estado:!1},{codigo:39,nombre:"derecha",estado:!1},{codigo:32,nombre:"disparar",estado:!1}];function e(){for(var e,o=window.event.keyCode,a=0;a<t.length;a++)if(o==(e=t[a]).codigo){e.estado=!1;break}}function o(){for(var e,o=window.event.keyCode,a=0;a<t.length;a++)if(o==(e=t[a]).codigo){e.estado=!0;break}t[2].estado&&n.trigger("dispara")}return n.derecha=function(){return t[1].estado},n.izquierda=function(){return t[0].estado},n.on("keyup",e),n.on("keydown",o),n}$.ajax({url:url,type:"GET",dataType:"html",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){console.log("enviado")},complete:function(){console.log("completo")},success:function(e){console.log("todo nos fue bien",e);e=JSON.parse(e);console.log("Datos son:",e[0]),mostrartabla(e)},error:function(e,o,a){console.log("hay un erorro")}});